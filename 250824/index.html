<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EscapeRoom - 250824</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<style>
:root {
  --active: #007bff;
  --success: #28a745;
  --danger: #dc3545;
  --hint: #17a2b8;
  --bg: #f0f2f5;
  --card-bg: #ffffff;
}

* { box-sizing: border-box; }

body {
  font-family: 'Pretendard', sans-serif;
  background: var(--bg);
  margin: 0;
  padding: 30px 15px;
  display: flex;
  flex-direction: column;
  align-items: center;
}

/* ê°€ë¡œ ë„ˆë¹„ 800px ì„¤ì • */
.container-fixed {
  width: 100%;
  max-width: 800px;
  background: var(--card-bg);
  border-radius: 24px;
  padding: 35px;
  box-shadow: 0 15px 35px rgba(0,0,0,0.07);
  margin-bottom: 30px;
}

h1 { margin: 0 0 25px; font-size: 32px; text-align: center; font-weight: 800; }

/* ë‹¨ê³„ë³„ ì§ˆë¬¸ ìŠ¤íƒ€ì¼ */
.quiz-question {
  font-size: 28px;
  font-weight: 700;
  text-align: center;
  margin-bottom: 20px;
  color: #444;
}

.stage-button-container {
  display: grid;
  grid-template-columns: repeat(5, minmax(0, 1fr));
  gap: 12px;
  width: 100%;
}

.stage-button {
  width: 100%;
  padding: 18px 5px;
  border-radius: 12px;
  border: 1px solid #e9ecef;
  background: #f8f9fa;
  font-size: 20px;
  font-weight: 700;
  cursor: pointer;
  transition: 0.2s;
}

.stage-button.active { background: var(--active); color: #fff; border-color: var(--active); box-shadow: 0 4px 12px rgba(0,123,255,0.3); }
.stage-button.stage-success { background: var(--success); color: #fff; border-color: var(--success); }

.status-bar { display: flex; justify-content: flex-end; margin-top: 20px; gap: 15px; }

.badge { padding: 8px 18px; border-radius: 30px; font-size: 18px; font-weight: 700; border: 1px solid; }
.wrong-badge { background: #fff5f5; color: var(--danger); border-color: #ffe3e3; }
.hint-badge { background: #e7faff; color: var(--hint); border-color: #bee5eb; display: none; }

.quiz-image { 
  width: 100%; 
  border-radius: 15px; 
  display: block; 
  margin: 0 auto; 
  cursor: pointer;
  background: #eee; /* ì´ë¯¸ì§€ ë¡œë”© ì „ ë°°ê²½ */
  min-height: 200px;
  object-fit: contain;
}

.input-group { margin: 30px 0; display: flex; justify-content: center; gap: 15px; }
#answer { flex: 1; max-width: 250px; font-size: 24px; padding: 15px; border-radius: 15px; border: 3px solid #dee2e6; text-align: center; }

.btn-submit {
  padding: 15px 35px; border-radius: 15px; background: var(--active);
  color: #fff; border: none; font-size: 22px; font-weight: 700; cursor: pointer;
}

.btn-hint {
  padding: 12px 20px; border-radius: 10px; border: 2px solid #dee2e6;
  background: #fff; font-size: 18px; margin: 5px; cursor: pointer; transition: 0.2s;
}
.btn-hint.enabled { background: #e7f1ff; border-color: var(--active); color: var(--active); font-weight: bold; }

.hint-content {
  background: #f8f9fa; padding: 20px; border-radius: 15px;
  margin-top: 20px; font-size: 20px; border-left: 6px solid var(--active);
  line-height: 1.6;
}

.success-overlay {
  position: fixed; inset: 0; background: rgba(0,0,0,0.6);
  backdrop-filter: blur(6px); display: flex; justify-content: center; align-items: center; z-index: 10000;
}
.success-modal { background: #fff; padding: 40px; border-radius: 30px; text-align: center; width: 90%; max-width: 450px; }
.success-modal h2 { font-size: 36px; margin-bottom: 10px; }

#final-success {
  position: fixed; inset: 0; background: rgba(255,255,255,0.95); z-index: 11000;
  display: flex; justify-content: center; align-items: center; cursor: pointer;
}
#final-success img { max-width: 90%; max-height: 90%; object-fit: contain; }

@media (max-width: 600px) {
  .stage-button { font-size: 13px; padding: 12px 2px; }
  h1 { font-size: 24px; }
  .quiz-question { font-size: 20px; }
  .btn-submit { font-size: 18px; }
  .badge { font-size: 14px; padding: 6px 12px; }
}
</style>
</head>
<body>

<div class="container-fixed">
  <h1>EscapeRoom - 250824</h1>
  <div id="stage-buttons" class="stage-button-container"></div>
  <div class="status-bar">
    <div id="hint-count-badge" class="badge hint-badge">íŒíŠ¸ ì‚¬ìš© íšŸìˆ˜: <span id="total-hint-count">0</span></div>
    <div class="badge wrong-badge">ëˆ„ì  ì˜¤ë‹µ: <span id="wrong-count">0</span></div>
  </div>
</div>

<div id="puzzle" class="container-fixed"></div>

<script>
// --- [ì¤‘ìš”] ì—¬ê¸°ì„œ ë‹¨ê³„ë³„ ì§ˆë¬¸ê³¼ ì´ë¯¸ì§€ë¥¼ ìˆ˜ì •í•˜ì„¸ìš” ---
const puzzleData = [
  {stage:1, question:"?ëŠ” ë¬´ì—‡ì¼ê¹Œìš”?", image:"p1.png", answer:"2", inputType:"number", hints:[{type:'text',content:'ê°œìˆ˜'},{type:'text',content:'ë™ê·¸ë¼ë¯¸ ê°œìˆ˜'}]},
  {stage:2, question:"?ëŠ” ë¬´ì—‡ì¼ê¹Œìš”?", image:"p2.png", answer:["228","229"], inputType:"number", hints:[{type:'text',content:'ë‹¬ë ¥'},{type:'text',content:'2ì›”ì€?'}]},
  {stage:3, question:"?ëŠ” ë¬´ì—‡ì¼ê¹Œìš”?", image:"p3.png", answer:"85", inputType:"number", hints:[{type:'text',content:'ì œê³±'},{type:'text',content:'ë”í•˜ê¸°'}]},
  {stage:4, question:"?ëŠ” ë¬´ì—‡ì¼ê¹Œìš”?", image:"p4.png", answer:"18", inputType:"number", hints:[{type:'text',content:'ì œê³±'},{type:'text',content:'ê±°ê¾¸ë¡œ'}]},
  {stage:5, question:"ABCDEëŠ” ë¬´ì—‡ì¼ê¹Œìš”? ë‹¤ì„¯ìë¦¬ ìˆ«ìì…ë‹ˆë‹¤.", image:"p5.png", answer:"42857", inputType:"number", hints:[{type:'text',content:'E=7'},{type:'text',content:'A=4'}]},
  {stage:6, question:"ìˆ«ì 4ìë¦¬ë¥¼ ì°¾ìœ¼ì„¸ìš”.", image:"p6.png", answer:"5104", inputType:"number", hints:[{type:'image',content:'h6.png'},{type:'text',content:'ì†Œìˆ˜ë§Œ ì½ì–´ë¼'}]},
  {stage:7, question:"ì˜ë¯¸í•˜ëŠ” ê²ƒì„ ì…ë ¥í•˜ì„¸ìš”.", image:"p7.png", answer:"ë§¤ë“­", inputType:"text", hints:[{type:'text',content:'2ê¸€ì ë‹¨ì–´'},{type:'text',content:'ë¹¨ê°•+íŒŒë‘=ë³´ë¼'}]},
  {stage:8, question:"?ëŠ” ë¬´ì—‡ì¼ê¹Œìš”?", image:"p8.png", answer:"8", inputType:"number", hints:[{type:'image',content:'h8.png'}]},
  {stage:9, question:"?ëŠ” ë¬´ì—‡ì¼ê¹Œìš”?", image:"p9.png", answer:"39", inputType:"number", hints:[{type:'text',content:'3ì´ 2ë²ˆ'},{type:'text',content:'3Ã—12=36'}]},
  {stage:10, question:"?ëŠ” ë¬´ì—‡ì¼ê¹Œìš”?", image:"p10.png", answer:"10000", inputType:"number", hints:[{type:'text',content:'1ì€ -'},{type:'text',content:'10ì€ +'},{type:'text',content:'í•œê¸€ë¡œ'}]}
];

let currentStage = 1;
let totalWrongCount = 0;
const clearedStages = new Set();
const hintUsage = {};
const stageState = {};

function updateStatusBar() {
  const totalHints = Object.values(hintUsage).reduce((acc, curr) => acc + curr, 0);
  if (totalHints > 0) {
    $("#hint-count-badge").css("display", "inline-block");
    $("#total-hint-count").text(totalHints);
  } else {
    $("#hint-count-badge").hide();
  }
  $("#wrong-count").text(totalWrongCount);
}

function renderStageButtons() {
  const c = $("#stage-buttons").empty();
  puzzleData.forEach(p => {
    const h = hintUsage[p.stage] || 0;
    const label = h > 0 ? `${p.stage}ë‹¨ê³„(${h})` : `${p.stage}ë‹¨ê³„`;
    let cls = "stage-button";
    if (p.stage === currentStage) cls += " active";
    else if (clearedStages.has(p.stage)) cls += " stage-success";
    c.append(`<button class="${cls}" onclick="selectStage(${p.stage})">${label}</button>`);
  });
}

function loadPuzzle(stage) {
  const p = puzzleData.find(x => x.stage === stage);
  const saved = stageState[stage] || {};
  let hintBtns = "", hintDivs = "";

  p.hints.forEach((h, i) => {
    const used = (hintUsage[stage] || 0) >= i + 1;
    const enabled = i === 0 || (hintUsage[stage] || 0) >= i;
    hintBtns += `<button class="btn-hint ${enabled ? "enabled" : ""}" ${enabled ? "" : "disabled"} onclick="toggleHint(${i + 1})">íŒíŠ¸ ${i + 1}</button>`;
    if (used) {
      const content = h.type === "text" ? h.content : `<img src="${h.content}" class="quiz-image" onerror="this.alt='íŒíŠ¸ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤ (${h.content})'">`;
      hintDivs += `<div class="hint-content">${content}</div>`;
    }
  });

  $("#puzzle").html(`
    <div class="quiz-question">${p.question}</div>
    <img src="${p.image}" class="quiz-image" onclick="toggleImageZoom(this.src)" onerror="this.alt='ì´ë¯¸ì§€ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤ (${p.image})'">
    <div class="input-group">
      <input id="answer" type="${p.inputType}" value="${saved.answer || ""}" placeholder="ì •ë‹µ ì…ë ¥" onkeypress="if(event.keyCode==13) checkAnswer()">
      <button class="btn-submit" onclick="checkAnswer()">í™•ì¸</button>
    </div>
    <p id="result" style="font-weight:700; height:30px; margin:15px 0; font-size:22px; text-align:center;">${saved.result || ""}</p>
    <div style="border-top:2px solid #eee; padding-top:25px; margin-top:20px;">${hintBtns}</div>
    ${hintDivs}
  `);
}

function checkAnswer() {
  const p = puzzleData.find(x => x.stage === currentStage);
  const v = $("#answer").val().trim();
  const ok = Array.isArray(p.answer) ? p.answer.includes(v) : v === p.answer;

  if (ok) {
    stageState[currentStage] = { answer: v, result: "ì •ë‹µ!" };
    clearedStages.add(currentStage);
    renderStageButtons();
    showSuccess();
  } else {
    totalWrongCount++;
    updateStatusBar();
    $("#result").css("color", "var(--danger)").text("í‹€ë ¸ìŠµë‹ˆë‹¤! ë‹¤ì‹œ ìƒê°í•´ë³´ì„¸ìš”.");
  }
}

function showSuccess() {
  const modal = $(`
    <div class="success-overlay">
      <div class="success-modal">
        <h2 style="color:var(--success)">ğŸ‰ ì •ë‹µ!</h2>
        <p style="font-size:20px;">ì •ë§ ëŒ€ë‹¨í•˜ì‹œë„¤ìš”!</p>
        <button id="modalNextBtn" class="btn-submit" style="width:100%; margin-top:25px;">ë‹¤ìŒìœ¼ë¡œ</button>
      </div>
    </div>
  `);
  $("body").append(modal);

  const handleEnter = (e) => {
    if (e.key === "Enter") {
      nextAction();
      $(document).off("keydown", handleEnter);
    }
  };
  $(document).on("keydown", handleEnter);

  $("#modalNextBtn").click(() => {
    nextAction();
    $(document).off("keydown", handleEnter);
  });
}

function nextAction() {
  $(".success-overlay").remove();
  if (clearedStages.size === puzzleData.length) {
    showFinalSuccess();
    return;
  }
  let nextStage = -1;
  for (let i = currentStage + 1; i <= puzzleData.length; i++) {
    if (!clearedStages.has(i)) { nextStage = i; break; }
  }
  if (nextStage === -1) {
    for (let i = 1; i <= puzzleData.length; i++) {
      if (!clearedStages.has(i)) { nextStage = i; break; }
    }
  }
  if (nextStage !== -1) selectStage(nextStage);
}

function showFinalSuccess() {
  const finalLayer = $(`
    <div id="final-success">
      <img src="success.png" alt="ì„±ê³µ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤ (success.png)" onerror="this.style.display='none'; alert('ì¶•í•˜í•©ë‹ˆë‹¤! ëª¨ë“  ë‹¨ê³„ë¥¼ í´ë¦¬ì–´í–ˆìŠµë‹ˆë‹¤.')">
      <div style="position:absolute; bottom:50px; font-size:20px; color:#666;">ì´ë¯¸ì§€ë¥¼ í´ë¦­í•˜ë©´ í€´ì¦ˆë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.</div>
    </div>
  `);
  finalLayer.click(function() {
    $(this).fadeOut(400, function() { $(this).remove(); });
  });
  $("body").append(finalLayer);
}

function toggleImageZoom(src) {
  const o = $(`<div style="position:fixed;inset:0;background:rgba(0,0,0,0.9);z-index:20000;display:flex;justify-content:center;align-items:center;cursor:zoom-out;">
    <img src="${src}" style="max-width:95%;max-height:95%;object-fit:contain;">
  </div>`);
  o.click(function(){ $(this).remove(); });
  $("body").append(o);
}

function toggleHint(n) {
  hintUsage[currentStage] = Math.max(hintUsage[currentStage] || 0, n);
  updateStatusBar();
  renderStageButtons();
  loadPuzzle(currentStage);
}

function selectStage(s) {
  currentStage = s;
  loadPuzzle(s);
  renderStageButtons();
}

$(document).ready(() => {
  updateStatusBar();
  renderStageButtons();
  selectStage(1);
});
</script>

</body>
</html>
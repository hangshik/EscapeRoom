<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <style>
    .quiz-container { text-align: center; }
    .button { font-size: 15px; padding: 14px; border: none; border-radius: 8px; background: #339af0; color: #fff; cursor: pointer; }
    .quiz { font-size: 24px; margin: 20px 0; }
    #answer { padding: 8px 12px; font-size: 18px; width: 100px; text-align: center; border: 1px solid #ced4da; border-radius: 6px; }
    #result { font-size: 20px; margin-top: 12px; font-weight: bold; height: 24px; }
    #next-stage-btn {
      font-size: 18px; margin-top: 10px; padding: 10px 20px; border: none;
      border-radius: 8px; cursor: pointer; background-color: #28a745;
      color: white; font-weight: bold; transition: background-color 0.2s;
    }
    #next-stage-btn:hover { background-color: #218838; }
    .button:disabled, .button.disabled {
      background: #adb5bd !important;
      color: #f1f3f5 !important;
      cursor: not-allowed !important;
    }
  </style>
</head>
<body>
  <div class="quiz-container">
    <br>
    <img src="p5.png" width="450px" alt="문제 이미지">
    <br><br>
    <input type="number" id="answer">
    <button class="button" onclick="checkAnswer()">확인</button>
    
    <p id="result"></p><br><br>

    <button class="button" id="hint1-btn" onclick="toggleHint1()">힌트1</button>
    <button class="button" id="hint2-btn" onclick="toggleHint2()" disabled>힌트2</button>
    
    <div id="hint1" class="quiz" style="display: none;">E=7</div>
    <div id="hint2" class="quiz" style="display: none;">A=4</div>
  </div>

  <script>
    (function() {
      const ThisStage = 5;
      const correctAnswer = "42857";
    
      window.checkAnswer = function() {
        const answerInput = document.getElementById("answer");
        const resultEl = document.getElementById("result");
        const isCorrect = (answerInput.value.trim() === correctAnswer);
    
        if (isCorrect) {
          resultEl.textContent = `정답 → ${correctAnswer}`;
          resultEl.style.color = "green";
          answerInput.disabled = true;
    
          $(document).trigger('clearStage', { stage: ThisStage });
    
          if (!document.getElementById("next-stage-btn")) {
            const nextButton = document.createElement("button");
            nextButton.id = "next-stage-btn";
            nextButton.textContent = "다음 단계 →";
            nextButton.onclick = advanceToNextStage;
            resultEl.after(nextButton);
          }
        } else {
          resultEl.textContent = "틀렸습니다. 다시 시도하세요.";
          resultEl.style.color = "red";
          // 오답 횟수 증가 부분
          $(document).trigger('wrongAnswer', { stage: ThisStage }); 
          setTimeout(() => {
            resultEl.textContent = "";
          }, 2000);
        }
      };
    
      function advanceToNextStage() {
        const nextStage = ThisStage + 1;
        $(document).trigger('selectStage', { stage: nextStage });
      }
    
      document.getElementById("answer").addEventListener("keydown", (e) => {
        if (e.key === "Enter") window.checkAnswer();
      });
    
      document.addEventListener("keydown", (e) => {
        const answerInput = document.getElementById("answer");
        if (answerInput.disabled && (e.code === "Space" || e.key === " ")) {
          const nextBtn = document.getElementById("next-stage-btn");
          if (nextBtn) {
            e.preventDefault();
            nextBtn.click();
          }
        }
      });
    
      // 힌트 토글 함수
      window.toggleHint1 = function() {
        const hint1 = document.getElementById("hint1");
        const hint2 = document.getElementById("hint2");
        const hint2Btn = document.getElementById("hint2-btn");
    
        if (hint1.style.display === "none") {
          hint1.style.display = "block";
          hint2.style.display = "none";
          hint2Btn.disabled = false;
          hint2Btn.classList.remove("disabled");

          // 힌트1 사용 기록 (header에서 최대값 유지)
          $(document).trigger('updateHint', { stage: ThisStage, count: 1 });
        } else {
          hint1.style.display = "none";
        }
      };
    
      window.toggleHint2 = function() {
        const hint2 = document.getElementById("hint2");
        const hint1 = document.getElementById("hint1");
    
        if (hint2.style.display === "none") {
          hint2.style.display = "block";
          hint1.style.display = "none";

          // 힌트2 사용 기록 (header에서 최대값 유지)
          $(document).trigger('updateHint', { stage: ThisStage, count: 2 });
        } else {
          hint2.style.display = "none";
        }
      };
    })();
  </script>
</body>
</html>
